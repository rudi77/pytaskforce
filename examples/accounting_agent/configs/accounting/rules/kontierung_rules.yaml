# Kontierung Rules for German Accounting (SKR03/SKR04)
# Version: 2.0 - Enhanced with Semantic Rules Engine support
# These rules are used by SemanticRuleEngineTool for intelligent account assignment
#
# Rule Types:
# - vendor_rules: Direct vendor → account mapping (highest priority)
# - semantic_rules: Vendor + item patterns with embedding similarity
# - expense_categories: Legacy keyword-based rules (backward compatible)

version: "2.0"
chart_of_accounts: SKR03

# =============================================================================
# VENDOR-ONLY RULES (Regeltyp A - Highest Priority)
# Direct mapping: Vendor → Account
# No item pattern matching required
# =============================================================================

vendor_rules:
  # Cloud & Infrastructure
  - rule_id: "VR-001"
    vendor_pattern: "Amazon Web Services"
    target_account: "6805"
    target_account_name: "Porto (SKR04 Mapping für Cloud)"
    priority: 100
    legal_basis: "§4 Abs. 4 EStG"

  - rule_id: "VR-002"
    vendor_pattern: "Microsoft (Ireland|Azure)"
    target_account: "4964"
    target_account_name: "Aufwendungen für Software"
    priority: 100
    legal_basis: "§4 Abs. 4 EStG"

  - rule_id: "VR-003"
    vendor_pattern: "Google Cloud"
    target_account: "6805"
    target_account_name: "EDV-Kosten"
    priority: 100
    legal_basis: "§4 Abs. 4 EStG"

  # Telecommunications
  - rule_id: "VR-004"
    vendor_pattern: "Deutsche Telekom"
    target_account: "4920"
    target_account_name: "Telefon"
    priority: 100
    legal_basis: "§4 Abs. 4 EStG"

  - rule_id: "VR-005"
    vendor_pattern: "Vodafone"
    target_account: "4920"
    target_account_name: "Telefon"
    priority: 100
    legal_basis: "§4 Abs. 4 EStG"

  # Professional Services
  - rule_id: "VR-006"
    vendor_pattern: "DATEV"
    target_account: "4950"
    target_account_name: "Rechts- und Beratungskosten"
    priority: 100
    legal_basis: "§4 Abs. 4 EStG"

# =============================================================================
# SEMANTIC RULES (Regeltyp B - Medium Priority)
# Vendor pattern + Item patterns with embedding similarity
# similarity_threshold: Minimum cosine similarity (0.0-1.0)
# =============================================================================

semantic_rules:
  # Office Supplies (semantic matching)
  - rule_id: "SR-001"
    vendor_pattern: ".*"  # Any vendor
    item_patterns:
      - "Bürobedarf"
      - "Schreibwaren"
      - "Druckerpapier"
      - "Kopierpapier"
      - "Toner"
      - "Druckerpatrone"
      - "Ordner"
      - "Heftklammern"
    target_account: "4930"
    target_account_name: "Bürobedarf"
    priority: 50
    similarity_threshold: 0.8
    legal_basis: "§4 Abs. 4 EStG"

  # Literature & Subscriptions
  - rule_id: "SR-002"
    vendor_pattern: ".*"
    item_patterns:
      - "Fachliteratur"
      - "Fachbuch"
      - "Fachzeitschrift"
      - "Abonnement"
      - "Zeitschrift"
    target_account: "4940"
    target_account_name: "Zeitschriften, Bücher"
    priority: 50
    similarity_threshold: 0.8
    legal_basis: "§4 Abs. 4 EStG"

  # IT Equipment (semantic)
  - rule_id: "SR-003"
    vendor_pattern: ".*"
    item_patterns:
      - "Laptop"
      - "Notebook"
      - "Computer"
      - "Monitor"
      - "Tastatur"
      - "Maus"
      - "Server"
      - "Drucker"
    target_account: "4985"
    target_account_name: "Werkzeuge und Kleingeräte (GWG)"
    priority: 50
    similarity_threshold: 0.75
    legal_basis: "§6 Abs. 2 EStG"
    note: "Für Beträge < 800 EUR. Höhere Beträge: 0420 (Anlagevermögen)"

  # Software & Licenses
  - rule_id: "SR-004"
    vendor_pattern: ".*"
    item_patterns:
      - "Software"
      - "Lizenz"
      - "SaaS"
      - "Cloud-Service"
      - "Subscription"
    target_account: "4964"
    target_account_name: "Aufwendungen für Software (GWG)"
    priority: 50
    similarity_threshold: 0.8
    legal_basis: "§6 Abs. 2 EStG"

  # Travel & Hospitality
  - rule_id: "SR-005"
    vendor_pattern: ".*"
    item_patterns:
      - "Reise"
      - "Flug"
      - "Hotel"
      - "Übernachtung"
      - "Mietwagen"
      - "Bahnfahrt"
    target_account: "4660"
    target_account_name: "Reisekosten Arbeitnehmer"
    priority: 50
    similarity_threshold: 0.8
    legal_basis: "§9 Abs. 1 Nr. 4a EStG"

  # Entertainment
  - rule_id: "SR-006"
    vendor_pattern: ".*"
    item_patterns:
      - "Bewirtung"
      - "Geschäftsessen"
      - "Restaurant"
      - "Gaststätte"
    target_account: "4650"
    target_account_name: "Bewirtungskosten"
    priority: 50
    similarity_threshold: 0.8
    legal_basis: "§4 Abs. 5 Nr. 2 EStG"
    note: "70% abzugsfähig"

  # Training & Education
  - rule_id: "SR-007"
    vendor_pattern: ".*"
    item_patterns:
      - "Fortbildung"
      - "Schulung"
      - "Seminar"
      - "Workshop"
      - "Weiterbildung"
      - "Zertifizierung"
    target_account: "4945"
    target_account_name: "Fortbildungskosten"
    priority: 50
    similarity_threshold: 0.8
    legal_basis: "§4 Abs. 4 EStG"

  # Consulting & Legal
  - rule_id: "SR-008"
    vendor_pattern: ".*"
    item_patterns:
      - "Beratung"
      - "Consulting"
      - "Rechtsanwalt"
      - "Steuerberater"
      - "Wirtschaftsprüfer"
    target_account: "4950"
    target_account_name: "Rechts- und Beratungskosten"
    priority: 50
    similarity_threshold: 0.8
    legal_basis: "§4 Abs. 4 EStG"

# =============================================================================
# LEGACY EXPENSE CATEGORIES (Backward Compatibility)
# Keyword-based matching for RuleEngineTool
# =============================================================================

# Expense categories with keyword matching and account assignments
expense_categories:
  # Bürobedarf und Schreibwaren
  office_supplies:
    keywords:
      - "Bürobedarf"
      - "Schreibwaren"
      - "Papier"
      - "Druckerpapier"
      - "Kugelschreiber"
      - "Ordner"
      - "Heftklammern"
      - "Toner"
      - "Druckerpatrone"
      - "Briefumschläge"
    debit_account: "4930"
    debit_name: "Bürobedarf"
    legal_basis: "§4 Abs. 4 EStG"

  # Fachliteratur und Zeitschriften
  literature:
    keywords:
      - "Fachliteratur"
      - "Fachbuch"
      - "Zeitschrift"
      - "Abonnement"
      - "Fachzeitschrift"
    debit_account: "4940"
    debit_name: "Zeitschriften, Bücher"
    legal_basis: "§4 Abs. 4 EStG"

  # Porto und Versand
  postage:
    keywords:
      - "Porto"
      - "Versand"
      - "Paketversand"
      - "Briefmarken"
      - "DHL"
      - "Hermes"
      - "UPS"
      - "FedEx"
    debit_account: "4910"
    debit_name: "Porto"
    legal_basis: "§4 Abs. 4 EStG"

  # Telefon und Internet
  telecommunications:
    keywords:
      - "Telefon"
      - "Telekom"
      - "Vodafone"
      - "Internet"
      - "DSL"
      - "Mobilfunk"
      - "Handy"
      - "SIM-Karte"
    debit_account: "4920"
    debit_name: "Telefon"
    legal_basis: "§4 Abs. 4 EStG"

  # EDV/IT Equipment - with GWG threshold
  it_equipment:
    keywords:
      - "Computer"
      - "Laptop"
      - "Notebook"
      - "Monitor"
      - "Bildschirm"
      - "Drucker"
      - "Scanner"
      - "Tastatur"
      - "Maus"
      - "Server"
      - "PC"
      - "Desktop"
      - "Workstation"
    conditions:
      - if_amount_below: 800
        debit_account: "4985"
        debit_name: "Werkzeuge und Kleingeräte (GWG)"
        legal_basis: "§6 Abs. 2 EStG"
      - if_amount_above: 800
        debit_account: "0420"
        debit_name: "EDV-Anlagen (Anlagevermögen)"
        legal_basis: "§7 Abs. 1 EStG"
        afa_years: 3

  # Software
  software:
    keywords:
      - "Software"
      - "Lizenz"
      - "Microsoft"
      - "Adobe"
      - "Subscription"
      - "SaaS"
      - "Cloud-Service"
    conditions:
      - if_amount_below: 800
        debit_account: "4964"
        debit_name: "Aufwendungen für Software (GWG)"
        legal_basis: "§6 Abs. 2 EStG"
      - if_amount_above: 800
        debit_account: "0027"
        debit_name: "EDV-Software (Anlagevermögen)"
        legal_basis: "§7 Abs. 1 EStG"
        afa_years: 3

  # Büromöbel
  office_furniture:
    keywords:
      - "Schreibtisch"
      - "Bürostuhl"
      - "Stuhl"
      - "Regal"
      - "Schrank"
      - "Aktenschrank"
      - "Rollcontainer"
    conditions:
      - if_amount_below: 800
        debit_account: "4985"
        debit_name: "Werkzeuge und Kleingeräte (GWG)"
        legal_basis: "§6 Abs. 2 EStG"
      - if_amount_above: 800
        debit_account: "0410"
        debit_name: "Geschäftsausstattung (Anlagevermögen)"
        legal_basis: "§7 Abs. 1 EStG"
        afa_years: 13

  # Reisekosten
  travel:
    keywords:
      - "Reise"
      - "Flug"
      - "Bahn"
      - "DB"
      - "Deutsche Bahn"
      - "Hotel"
      - "Übernachtung"
      - "Mietwagen"
    debit_account: "4660"
    debit_name: "Reisekosten Arbeitnehmer"
    legal_basis: "§9 Abs. 1 Nr. 4a EStG"

  # Bewirtung
  entertainment:
    keywords:
      - "Bewirtung"
      - "Restaurant"
      - "Geschäftsessen"
      - "Gaststätte"
    debit_account: "4650"
    debit_name: "Bewirtungskosten"
    legal_basis: "§4 Abs. 5 Nr. 2 EStG"
    note: "70% abzugsfähig"

  # Fortbildung
  training:
    keywords:
      - "Fortbildung"
      - "Schulung"
      - "Seminar"
      - "Kurs"
      - "Workshop"
      - "Weiterbildung"
      - "Zertifizierung"
    debit_account: "4945"
    debit_name: "Fortbildungskosten"
    legal_basis: "§4 Abs. 4 EStG"

  # Beratung
  consulting:
    keywords:
      - "Beratung"
      - "Consulting"
      - "Steuerberater"
      - "Rechtsanwalt"
      - "Notar"
      - "Wirtschaftsprüfer"
    debit_account: "4950"
    debit_name: "Rechts- und Beratungskosten"
    legal_basis: "§4 Abs. 4 EStG"

  # Versicherungen
  insurance:
    keywords:
      - "Versicherung"
      - "Haftpflicht"
      - "Betriebshaftpflicht"
      - "Berufshaftpflicht"
    debit_account: "4360"
    debit_name: "Versicherungen"
    legal_basis: "§4 Abs. 4 EStG"

  # Miete/Leasing
  rent:
    keywords:
      - "Miete"
      - "Büromiete"
      - "Leasing"
      - "Mietkosten"
    debit_account: "4210"
    debit_name: "Miete (unbewegliche Wirtschaftsgüter)"
    legal_basis: "§4 Abs. 4 EStG"

  # Werbekosten
  advertising:
    keywords:
      - "Werbung"
      - "Marketing"
      - "Anzeige"
      - "Google Ads"
      - "Facebook Ads"
      - "Flyer"
      - "Visitenkarten"
    debit_account: "4600"
    debit_name: "Werbekosten"
    legal_basis: "§4 Abs. 4 EStG"

  # Fremdleistungen
  subcontracting:
    keywords:
      - "Fremdleistung"
      - "Subunternehmer"
      - "Dienstleistung"
      - "Freelancer"
    debit_account: "4909"
    debit_name: "Fremdleistungen"
    legal_basis: "§4 Abs. 4 EStG"

  # Werkzeuge und Maschinen
  tools_machinery:
    keywords:
      - "Bohrmaschine"
      - "Werkzeug"
      - "Maschine"
      - "Akkuschrauber"
      - "Schleifmaschine"
      - "Säge"
      - "Kreissäge"
      - "Stichsäge"
      - "Winkelschleifer"
      - "Schweißgerät"
      - "Kompressor"
      - "Handwerkzeug"
    conditions:
      - if_amount_below: 800
        debit_account: "4985"
        debit_name: "Werkzeuge und Kleingeräte (GWG)"
        legal_basis: "§6 Abs. 2 EStG"
      - if_amount_above: 800
        debit_account: "0210"
        debit_name: "Maschinen (Anlagevermögen)"
        legal_basis: "§7 Abs. 1 EStG"
        afa_years: 10

  # Heizmaterial und Brennstoffe
  heating_fuel:
    keywords:
      - "Briketts"
      - "Kohle"
      - "Heizöl"
      - "Brennstoff"
      - "Pellets"
      - "Holzpellets"
      - "Brennholz"
      - "Kaminholz"
      - "Gas"
      - "Erdgas"
      - "Propangas"
    debit_account: "4230"
    debit_name: "Heizung"
    legal_basis: "§4 Abs. 4 EStG"
    note: "Oft ermäßigter Steuersatz 7%"

# VAT rules
vat_rules:
  standard_rate:
    rate: 0.19
    input_tax_account: "1576"
    input_tax_name: "Abziehbare Vorsteuer 19%"
    legal_basis: "§15 Abs. 1 UStG"

  reduced_rate:
    rate: 0.07
    input_tax_account: "1571"
    input_tax_name: "Abziehbare Vorsteuer 7%"
    legal_basis: "§15 Abs. 1 UStG"
    applies_to:
      - "Bücher"
      - "Lebensmittel"
      - "Zeitungen"
      - "Fahrkarten"

  reverse_charge:
    applies_when:
      - supplier_country: "!DE"
    vat_account: "1787"
    input_tax_account: "1577"
    legal_basis: "§13b UStG"
    note: "Steuerschuldnerschaft des Leistungsempfängers"

  zero_rate:
    rate: 0.00
    applies_when:
      - export: true
      - innergemeinschaftlich: true
    legal_basis: "§4 Nr. 1 UStG"

# Credit accounts (Haben-Konten)
credit_accounts:
  liabilities:
    account: "1600"
    name: "Verbindlichkeiten aus Lieferungen und Leistungen"
    skr04_account: "3300"

  bank:
    account: "1200"
    name: "Bank"
    skr04_account: "1800"

# SKR04 mapping (for conversion)
skr04_mapping:
  "4930": "6815"  # Bürobedarf
  "4940": "6820"  # Zeitschriften
  "4910": "6805"  # Porto
  "4920": "6810"  # Telefon
  "4985": "6845"  # GWG
  "0420": "0650"  # EDV-Anlagen
  "4964": "6835"  # Software-Aufwand
  "0027": "0135"  # Software-Anlage
  "0410": "0620"  # Geschäftsausstattung
  "0210": "0440"  # Maschinen
  "4230": "6320"  # Heizung
  "4660": "6660"  # Reisekosten
  "4650": "6640"  # Bewirtung
  "4945": "6825"  # Fortbildung
  "4950": "6830"  # Beratung
  "4360": "6400"  # Versicherungen
  "4210": "6310"  # Miete
  "4600": "6600"  # Werbekosten
  "4909": "6300"  # Fremdleistungen
  "1576": "1406"  # Vorsteuer 19%
  "1571": "1401"  # Vorsteuer 7%
  "1600": "3300"  # Verbindlichkeiten
